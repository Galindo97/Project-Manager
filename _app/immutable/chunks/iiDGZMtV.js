import{a0 as Ke,E as Be,ak as Ge,al as Le,j as Ue,b as qe,am as He,an as ke,ad as We,q as Je,n as J,ao as Ve,ap as Xe,f as K,p as Ye,M as V,a5 as Qe,u as Ze,N as A,g as et,w as b,i as p,r as m,x as U,I as s,aj as tt,ah as at,v as ye}from"./Cxs6_Da5.js";import{b as rt,c as q,a as y,d as st,f as O,t as ot,s as xe}from"./BPUFb_mI.js";import"./33NwUyeK.js";import{I as re,s as se,j as X,f as Y,d as it,e as nt,i as dt}from"./D34v4-Dx.js";import{l as oe,s as ie,p as ce}from"./CPoXIpK2.js";import{i as D}from"./Bv05hcF2.js";import{b as lt,I as ct}from"./Cwvagt3j.js";import{c as Q}from"./DEOuqFRv.js";import{B as te}from"./Ch2tKI4K.js";import{S as be}from"./CeMubZBB.js";import{X as ft}from"./C3s6pWLt.js";const ut=()=>performance.now(),C={tick:t=>requestAnimationFrame(t),now:()=>ut(),tasks:new Set};function Ie(){const t=C.now();C.tasks.forEach(e=>{e.c(t)||(C.tasks.delete(e),e.f())}),C.tasks.size!==0&&C.tick(Ie)}function vt(t){let e;return C.tasks.size===0&&C.tick(Ie),{promise:new Promise(o=>{C.tasks.add(e={c:t,f:o})}),abort(){C.tasks.delete(e)}}}function ae(t,e){ke(()=>{t.dispatchEvent(new CustomEvent(e))})}function pt(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(o=>o[0].toUpperCase()+o.slice(1)).join("")}function we(t){const e={},o=t.split(";");for(const d of o){const[a,i]=d.split(":");if(!a||i===void 0)break;const r=pt(a.trim());e[r]=i.trim()}return e}const mt=t=>t;function Rt(t,e,o,d){var a=(t&Ve)!==0,i=(t&Xe)!==0,r=a&&i,u=(t&He)!==0,S=r?"both":a?"in":"out",g,_=e.inert,E=e.style.overflow,w,$;function M(){return ke(()=>g??=o()(e,d?.()??{},{direction:S}))}var h={is_global:u,in(){if(e.inert=_,!a){$?.abort(),$?.reset?.();return}i||w?.abort(),ae(e,"introstart"),w=ue(e,M(),$,1,()=>{ae(e,"introend"),w?.abort(),w=g=void 0,e.style.overflow=E})},out(k){if(!i){k?.(),g=void 0;return}e.inert=!0,ae(e,"outrostart"),$=ue(e,M(),w,0,()=>{ae(e,"outroend"),k?.()})},stop:()=>{w?.abort(),$?.abort()}},f=Ke;if((f.transitions??=[]).push(h),a&&rt){var c=u;if(!c){for(var l=f.parent;l&&(l.f&Be)!==0;)for(;(l=l.parent)&&(l.f&Ge)===0;);c=!l||(l.f&Le)!==0}c&&Ue(()=>{qe(()=>h.in())})}}function ue(t,e,o,d,a){var i=d===1;if(We(e)){var r,u=!1;return Je(()=>{if(!u){var f=e({direction:i?"in":"out"});r=ue(t,f,o,d,a)}}),{abort:()=>{u=!0,r?.abort()},deactivate:()=>r.deactivate(),reset:()=>r.reset(),t:()=>r.t()}}if(o?.deactivate(),!e?.duration)return a(),{abort:J,deactivate:J,reset:J,t:()=>d};const{delay:S=0,css:g,tick:_,easing:E=mt}=e;var w=[];if(i&&o===void 0&&(_&&_(0,1),g)){var $=we(g(0,1));w.push($,$)}var M=()=>1-d,h=t.animate(w,{duration:S,fill:"forwards"});return h.onfinish=()=>{h.cancel();var f=o?.t()??1-d;o?.abort();var c=d-f,l=e.duration*Math.abs(c),k=[];if(l>0){var T=!1;if(g)for(var z=Math.ceil(l/16.666666666666668),B=0;B<=z;B+=1){var Z=f+c*E(B/z),H=we(g(Z,1-Z));k.push(H),T||=H.overflow==="hidden"}T&&(t.style.overflow="hidden"),M=()=>{var R=h.currentTime;return f+c*E(R/l)},_&&vt(()=>{if(h.playState!=="running")return!1;var R=M();return _(R,1-R),!0})}h=t.animate(k,{duration:l,fill:"forwards"}),h.onfinish=()=>{M=()=>d,_?.(d,1-d),a()}},{abort:()=>{h&&(h.cancel(),h.effect=null,h.onfinish=J)},deactivate:()=>{a=J},reset:()=>{d===0&&_?.(1,0)},t:()=>M()}}function fe(t,e){const o=oe(e,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M12 8V4H8"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2"}],["path",{d:"M2 14h2"}],["path",{d:"M20 14h2"}],["path",{d:"M15 13v2"}],["path",{d:"M9 13v2"}]];re(t,ie({name:"bot"},()=>o,{get iconNode(){return d},children:(a,i)=>{var r=q(),u=K(r);se(u,e,"default",{}),y(a,r)},$$slots:{default:!0}}))}function Dt(t,e){const o=oe(e,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M8 2v4"}],["path",{d:"M16 2v4"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2"}],["path",{d:"M3 10h18"}]];re(t,ie({name:"calendar"},()=>o,{get iconNode(){return d},children:(a,i)=>{var r=q(),u=K(r);se(u,e,"default",{}),y(a,r)},$$slots:{default:!0}}))}function gt(t,e){const o=oe(e,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];re(t,ie({name:"send"},()=>o,{get iconNode(){return d},children:(a,i)=>{var r=q(),u=K(r);se(u,e,"default",{}),y(a,r)},$$slots:{default:!0}}))}function $e(t,e){const o=oe(e,["children","$$slots","$$events","$$legacy"]);const d=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"}],["circle",{cx:"12",cy:"12",r:"3"}]];re(t,ie({name:"settings"},()=>o,{get iconNode(){return d},children:(a,i)=>{var r=q(),u=K(r);se(u,e,"default",{}),y(a,r)},$$slots:{default:!0}}))}const _t=t=>t;function ht(t){const e=t-1;return e*e*e+1}function Kt(t,{delay:e=0,duration:o=400,easing:d=_t}={}){const a=+getComputedStyle(t).opacity;return{delay:e,duration:o,easing:d,css:i=>`opacity: ${i*a}`}}function Bt(t,{delay:e=0,duration:o=400,easing:d=ht,axis:a="y"}={}){const i=getComputedStyle(t),r=+i.opacity,u=a==="y"?"height":"width",S=parseFloat(i[u]),g=a==="y"?["top","bottom"]:["left","right"],_=g.map(c=>`${c[0].toUpperCase()}${c.slice(1)}`),E=parseFloat(i[`padding${_[0]}`]),w=parseFloat(i[`padding${_[1]}`]),$=parseFloat(i[`margin${_[0]}`]),M=parseFloat(i[`margin${_[1]}`]),h=parseFloat(i[`border${_[0]}Width`]),f=parseFloat(i[`border${_[1]}Width`]);return{delay:e,duration:o,easing:d,css:c=>`overflow: hidden;opacity: ${Math.min(c*20,1)*r};${u}: ${c*S}px;padding-${g[0]}: ${c*E}px;padding-${g[1]}: ${c*w}px;margin-${g[0]}: ${c*$}px;margin-${g[1]}: ${c*M}px;border-${g[0]}-width: ${c*h}px;border-${g[1]}-width: ${c*f}px;min-${u}: 0`}}var yt=O('<div class="border-b bg-muted/50 px-6 py-4"><div class="space-y-3"><div class="space-y-1"><label for="api-key" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">Google Gemini API Key</label> <!></div> <!> <p class="text-xs text-muted-foreground">Get your API key for FREE at <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-primary hover:underline">Google AI Studio</a></p></div></div>'),xt=O('<div class="inline-flex items-center gap-1.5 rounded-full bg-primary/10 px-3 py-1 text-xs font-medium text-primary"><!> Task Context Active</div>'),bt=O(`<div class="flex flex-col items-center justify-center gap-4 py-10 text-center text-muted-foreground"><div class="rounded-full bg-muted p-4"><!></div> <div class="space-y-1"><h4 class="font-medium text-foreground">Hello! I'm your AI assistant</h4> <p class="text-sm">Ask me anything about your project or tasks.</p></div> <!></div>`),wt=O('<span class="text-xs font-bold">You</span>'),$t=O('<div><div><!></div> <div><div> </div> <span class="text-[10px] text-muted-foreground"> </span></div></div>'),kt=O('<div class="flex w-full gap-3"><div class="flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-primary text-primary-foreground"><!></div> <div class="flex items-center gap-1 rounded-2xl rounded-tl-none bg-muted px-4 py-3"><span class="h-1.5 w-1.5 animate-bounce rounded-full bg-foreground/50 [animation-delay:-0.3s]"></span> <span class="h-1.5 w-1.5 animate-bounce rounded-full bg-foreground/50 [animation-delay:-0.15s]"></span> <span class="h-1.5 w-1.5 animate-bounce rounded-full bg-foreground/50"></span></div></div>'),It=O('<div class="mb-3 flex items-center gap-2 rounded-lg bg-yellow-500/10 px-3 py-2 text-xs font-medium text-yellow-600 dark:text-yellow-500"><!> Configure your API key to start chatting</div>'),At=O('<div class="fixed inset-0 z-50 bg-background/80 backdrop-blur-sm" role="button" tabindex="0" aria-label="Close chat"></div> <div><div class="flex items-center justify-between border-b px-6 py-4"><div class="flex items-center gap-3"><div class="flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary"><!></div> <div><h3 class="font-semibold leading-none tracking-tight">AI Assistant</h3> <p class="text-sm text-muted-foreground">Smart project assistant</p></div></div> <div class="flex items-center gap-2"><!> <!></div></div> <!> <div class="flex flex-1 flex-col gap-4 overflow-y-auto p-6 h-[calc(100vh-180px)]"><!> <!></div> <div class="absolute bottom-0 left-0 right-0 border-t bg-background p-4"><!> <div class="flex gap-2"><textarea rows="1" class="flex min-h-11 w-full resize-none rounded-xl border border-input bg-background px-3 py-2.5 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"></textarea> <!></div></div></div>',1);function Gt(t,e){Ye(e,!0);let o=ce(e,"isOpen",15,!1);ce(e,"darkMode",3,!1);let d=ce(e,"taskId",3,void 0),a=V(Qe([])),i=V(""),r=V(""),u=V(!1),S=V(!1);const g="http://localhost:8000";Ze(()=>{if(typeof window<"u"){const f=localStorage.getItem("gemini_api_key");f&&A(r,f,!0)}});function _(){typeof window<"u"&&(localStorage.setItem("gemini_api_key",s(r)),A(u,!1))}async function E(){if(!s(i).trim())return;if(!s(r)||s(r).trim()===""){const l={role:"assistant",content:"⚠️ No has configurado tu API key de Gemini. Haz clic en el ícono de configuración ⚙️ arriba para agregarla.",timestamp:new Date};A(a,[...s(a),l],!0);return}const f={role:"user",content:s(i),timestamp:new Date};A(a,[...s(a),f],!0);const c=s(i);A(i,""),A(S,!0);try{const l=await fetch(`${g}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:c,task_id:d(),api_key:s(r)})});if(!l.ok){const z=await l.json().catch(()=>({detail:"Error desconocido"}));throw new Error(z.detail||"Error al comunicarse con la IA")}const T={role:"assistant",content:(await l.json()).response,timestamp:new Date};A(a,[...s(a),T],!0)}catch(l){const k={role:"assistant",content:`Error: ${l instanceof Error?l.message:"No se pudo conectar con la IA"}`,timestamp:new Date};A(a,[...s(a),k],!0)}finally{A(S,!1)}}function w(f){f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),E())}var $=q(),M=K($);{var h=f=>{var c=At(),l=K(c);l.__click=()=>o(!1),l.__keydown=n=>n.key==="Escape"&&o(!1);var k=b(l,2),T=p(k),z=p(T),B=p(z),Z=p(B);be(Z,{class:"h-5 w-5"}),m(B),U(2),m(z);var H=b(z,2),R=p(H);te(R,{variant:"ghost",size:"icon",onclick:()=>A(u,!s(u)),"aria-label":"Settings",children:(n,v)=>{$e(n,{class:"h-4 w-4"})},$$slots:{default:!0}});var Ae=b(R,2);te(Ae,{variant:"ghost",size:"icon",onclick:()=>o(!1),"aria-label":"Close",children:(n,v)=>{ft(n,{class:"h-4 w-4"})},$$slots:{default:!0}}),m(H),m(T);var ve=b(T,2);{var Se=n=>{var v=yt(),x=p(v),P=p(x),N=b(p(P),2);ct(N,{id:"api-key",type:"password",placeholder:"AIza...",class:"font-mono",get value(){return s(r)},set value(I){A(r,I,!0)}}),m(P);var F=b(P,2);te(F,{onclick:_,size:"sm",class:"w-full",children:(I,L)=>{U();var W=ot("Save API Key");y(I,W)},$$slots:{default:!0}}),U(2),m(x),m(v),y(n,v)};D(ve,n=>{s(u)&&n(Se)})}var ne=b(ve,2),pe=p(ne);{var Me=n=>{var v=bt(),x=p(v),P=p(x);fe(P,{class:"h-8 w-8"}),m(x);var N=b(x,4);{var F=I=>{var L=xt(),W=p(L);be(W,{class:"h-3 w-3"}),U(),m(L),y(I,L)};D(N,I=>{d()&&I(F)})}m(v),y(n,v)},Ne=n=>{var v=q(),x=K(v);nt(x,17,()=>s(a),dt,(P,N)=>{var F=$t(),I=p(F),L=p(I);{var W=j=>{var le=wt();y(j,le)},ze=j=>{fe(j,{class:"h-4 w-4"})};D(L,j=>{s(N).role==="user"?j(W):j(ze,!1)})}m(I);var de=b(I,2),ee=p(de),Fe=p(ee,!0);m(ee);var he=b(ee,2),je=p(he,!0);m(he),m(de),m(F),ye((j,le,Oe,Re,De)=>{Y(F,1,j),Y(I,1,le),Y(de,1,Oe),Y(ee,1,Re),xe(Fe,s(N).content),xe(je,De)},[()=>X(Q("flex w-full gap-3",s(N).role==="user"?"flex-row-reverse":"flex-row")),()=>X(Q("flex h-8 w-8 shrink-0 items-center justify-center rounded-full border",s(N).role==="assistant"?"bg-primary text-primary-foreground border-primary":"bg-muted text-muted-foreground")),()=>X(Q("flex max-w-[80%] flex-col gap-1",s(N).role==="user"?"items-end":"items-start")),()=>X(Q("rounded-2xl px-4 py-2.5 text-sm shadow-sm",s(N).role==="user"?"bg-primary text-primary-foreground rounded-tr-none":"bg-muted text-foreground rounded-tl-none")),()=>s(N).timestamp.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]),y(P,F)}),y(n,v)};D(pe,n=>{s(a).length===0?n(Me):n(Ne,!1)})}var Ee=b(pe,2);{var Pe=n=>{var v=kt(),x=p(v),P=p(x);fe(P,{class:"h-4 w-4"}),m(x),U(2),m(v),y(n,v)};D(Ee,n=>{s(S)&&n(Pe)})}m(ne);var me=b(ne,2),ge=p(me);{var Ce=n=>{var v=It(),x=p(v);$e(x,{class:"h-3 w-3"}),U(),m(v),y(n,v)};D(ge,n=>{s(r)||n(Ce)})}var _e=b(ge,2),G=p(_e);tt(G),G.__keydown=w;var Te=b(G,2);{let n=at(()=>!s(i).trim()||!s(r)||s(S));te(Te,{onclick:E,get disabled(){return s(n)},size:"icon",class:"h-11 w-11 shrink-0 rounded-xl",children:(v,x)=>{gt(v,{class:"h-4 w-4"})},$$slots:{default:!0}})}m(_e),m(me),m(k),ye(n=>{Y(k,1,n),it(G,"placeholder",s(r)?"Type your message...":"Configure API key first"),G.disabled=!s(r)||s(S)},[()=>X(Q("fixed inset-y-0 right-0 z-50 w-full max-w-md border-l bg-background p-0 shadow-lg transition-transform duration-300 ease-in-out sm:max-w-lg",o()?"translate-x-0":"translate-x-full"))]),lt(G,()=>s(i),n=>A(i,n)),y(f,c)};D(M,f=>{o()&&f(h)})}y(t,$),et()}st(["click","keydown"]);export{fe as B,Gt as C,Dt as a,Kt as f,Bt as s,Rt as t};
